/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java library project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.2/userguide/building_java_projects.html
 */

plugins {
    id 'shef.deps-conventions'
    id 'shef.java-conventions'
    id 'antlr'
}

dependencies {

    // This dependency is used internally, and not exposed to consumers on their own compile classpath.
    implementation(libs.com.google.guava)
    antlr(libs.org.antlr.antlr4)

    api(libs.org.antlr.antlr4.runtime)
}

sourceSets {
    main {
        java {
            srcDir "${project.buildDir}/generated/sources/antlr/main"
        }
    }
}

generateGrammarSource {
    arguments += ["-visitor","-long-messages","-package","org.opendcs.shef.parser"]
    outputDirectory = file("${project.buildDir}/generated/sources/antlr/main/org/opendcs/shef/parser")
}

sourcesJar.dependsOn generateGrammarSource

task grun(type: JavaExec) {
    dependsOn compileJava
    dependsOn generateGrammarSource
    classpath += sourceSets.main.runtimeClasspath
    classpath += fileTree(sourceSets.main.output.classesDirs.getAsPath())
    classpath += configurations.antlr
    main = "org.antlr.v4.gui.TestRig"
    args += "org.opendcs.shef.parser.shef"
    args += "shefFile"
    args += "-tokens"
    args += "-trace"
    args += "-diagnostics"
    args += "-gui"
    args += project.findProperty("shefFile") ?: "src/test/resources/original_a_only.shef"
    //args += "src/test/resources/a.shef"
}
